{% extends 'base.html' %} {% load static %}

  {% block content %}


  <style>
   
  body{
    background-color: #F6F5FA !important;
  }
  
  .progress{
    width: 170px !important;
    height: 7px !important;
    margin-top: 13px;
  }
  .dash{
    box-sizing: border-box;
    font-size: 16px;
    font-family: "Roboto";
    width: 100%;
    padding-left: 98px;
    padding-top: 9px;
    right: 0px;
    top: 0px;
    color: #047BD5;
    background-color: white;
    height: 42px;
  }
  .loader {
    border: 16px solid #f3f3f3;
    border-top: 16px solid #04E00D;
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
}
audio{
    height: 24px;
}
.aud{
  position: relative;
  display: grid;
}
#playBtn{
  position: absolute;
  z-index: 3;
  margin-left: 16px;
  margin-top: 2px;
  left:0
}
 </style>
  <main class="main-reminder">
    <!-- <div class="row"> -->
      
        <div class="scoretop">
            {% for i in s %}
            <input type="hidden" value="{{i.id}}" name="data_id"/>
            <div>{{i.agent}}</div>
            <div>{{i.direction}}</div>
            <div>{{i.sub}}</div>
            <div>{{i.phone}}</div>
            <div class="aud">
                <audio id="track1" src="{{i.recordingfile}}" controls="1"></audio>
                <img src="/static/Images/pause.png" class="playnow"  height="20px" id="playBtn" alt="">
            </div>
            <div>{{i.contacted_dt}}</div>
            {% endfor %}
            <div><div style="border-radius: 50%;height: 23px;width: 23px;background: #04E00D;padding-left: 6px;padding-top: 3px;" class="hideme" >
                <i class="fa-solid fa-arrow-down" style="    color: white;"></i></div>
            </div>
        </div>
        <div class="sparent">
            <div class="schild1">
                <form action="" method="post">
                    {% csrf_token %}
                <div>
                    <div class="sthdiv" style=" padding-top: 12px;">
                        <div class="sth" style="flex-basis: 668px;">Product</div>
                        <div class="sth"  >Maximum Score</div>
                        <div class="sth" style="flex-basis:90px;text-align: center;">Score</div>
                        
                    </div>
                </div>
                <div>
                    <div class="sthdiv">
                        <div class="col-md-8">
                            <div class="std" style="flex-basis: 496px;padding-top: 12px;">Accuracy of information and resolution provided to the guest  as per AST relevant for the call</div>
                    
                        </div>
                        <div class="col-md-4">
                            <div class="row" >
                         <div class="col-md-3">
                                <div class="std add" style="padding-top: 12px;">20</div>
                            </div>
                            <div class="col-md-9">
                                <div style="display: flex;column-gap: 32px;">
                                    <input type="number" name="1st" class="pin" autocomplete="off" required onkeypress="return isNumber(event)"/>
                                
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0"
                                            aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                                            <span class="sr-only">60% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                     </div>
                </div>
                <div>
                    <div class="sthdiv">
                        <div class="col-md-8">
                            <div class="std" style="flex-basis: 496px;padding-top: 12px;">Accuracy of Navigation in the System</div>
                     
                        </div>
                        <div class="col-md-4">
                            <div class="row" >
                           <div class="col-md-3">
                                <div class="std add" style="padding-top: 12px;">15</div>
                            </div>
                            <div class="col-md-9">
                                <div style="display: flex;column-gap: 32px;">
                                    <input type="number" name="2nd" class="pin" autocomplete="off" required onkeypress="return isNumber(event)"/>
                                
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0"
                                            aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                                            <span class="sr-only">60% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <div>
                    <div class="sthdiv">
                        <div class="col-md-8">
                            <div class="std" style="flex-basis: 496px;padding-top: 12px;">Correct SLA communicated to the guest/buying the time from guest</div>
                     
                        </div>
                        <div class="col-md-4">
                            <div class="row" >
                           <div class="col-md-3">
                                <div class="std add" style="padding-top: 12px;">10</div>
                            </div>
                            <div class="col-md-9">
                                <div style="display: flex;column-gap: 32px;">
                                    <input type="number" name="3rd" class="pin" autocomplete="off" required onkeypress="return isNumber(event)"/>
                                
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0"
                                            aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                                            <span class="sr-only">60% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
    
            </div>
            <div class="schild2">
                <div class="row">
                    <div class="sth" style="
                    margin-left: 12px;
                    width: 98%;
                    border-bottom: 1px solid #E1E1E1;">Soft Skills</div>
                   <div class="sthdiv">
                    <div class="col-md-8">
                        <div class="std" style="flex-basis: 496px;padding-top: 12px;">Warm Opening</div>
                 
                    </div>
                    <div class="col-md-4">
                        <div class="row" >
                       <div class="col-md-3">
                            <div class="std add" style="padding-top: 12px;">10</div>
                        </div>
                        <div class="col-md-9">
                            <div style="display: flex;column-gap: 32px;">
                                <input type="number" name="4th" class="pin" autocomplete="off" required onkeypress="return isNumber(event)"/>
                            
                                <div class="progress">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0"
                                        aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                                        <span class="sr-only">60% Complete</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                      
                        </div>
                    </div>
                    
    
                   </div>
    
                   <div class="sthdiv">
                    <div class="col-md-8">
                        <div class="std" style="flex-basis: 496px;padding-top: 12px;">Active Listening</div>
                 
                    </div>
                    <div class="col-md-4">
                        <div class="row">
                       <div class="col-md-3">
                            <div class="std add" style="padding-top: 12px;">05</div>
                        </div>
                        <div class="col-md-9">
                            <div style="display: flex;column-gap: 32px;">
                                <input type="number" name="5th" class="pin" autocomplete="off" required onkeypress="return isNumber(event)"/>
                            
                                <div class="progress">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0"
                                        aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                                        <span class="sr-only">60% Complete</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
    
    
                   </div>
                      
                   <div class="sthdiv">
                    <div class="col-md-8">
                        <div class="std" style="flex-basis: 496px;padding-top: 12px;">Personalisation and no jargons </div>
                 
                    </div>
                    <div class="col-md-4">
                        <div class="row" >
                       <div class="col-md-3">
                            <div class="std add" style="padding-top: 12px;">05</div>
                        </div>
                        <div class="col-md-9">
                            <div style="display: flex;column-gap: 32px;">
                                <input type="number" name="6th" class="pin" autocomplete="off" required onkeypress="return isNumber(event)"/>
                            
                                <div class="progress">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0"
                                        aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                                        <span class="sr-only">60% Complete</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
    
                   </div>
    
    
                   <div class="sthdiv">
                    <div class="col-md-8">
                        <div class="std" style="flex-basis: 496px;padding-top: 12px;">Emapthy/Sympathy & Assurance</div>
                 
                    </div>
                    <div class="col-md-4">
                        <div class="row" >
                       <div class="col-md-3">
                            <div class="std add" style="padding-top: 12px;">10</div>
                        </div>
                        <div class="col-md-9">
                            <div style="display: flex;column-gap: 32px;">
                                <input type="number" name="7th" class="pin" autocomplete="off" required onkeypress="return isNumber(event)"/>
                            
                                <div class="progress">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0"
                                        aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                                        <span class="sr-only">60% Complete</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
    
                   </div>
    
    
                    <div class="sthdiv">
                        <div class="col-md-8">
                            <div class="std" style="flex-basis: 496px;padding-top: 12px;">Politeness/Courtesy & Body language</div>
                     
                        </div>
                        <div class="col-md-4">
                            <div class="row" >
                           <div class="col-md-3">
                                <div class="std add" style="padding-top: 12px;">05</div>
                            </div>
                            <div class="col-md-9">
                                <div style="display: flex;column-gap: 32px;">
                                    <input type="number" name="8th" class="pin" autocomplete="off" required onkeypress="return isNumber(event)"/>
                                
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0"
                                            aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                                            <span class="sr-only">60% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
    
                    </div>
    
                    <div class="sthdiv">
                        <div class="col-md-8">
                            <div class="std" style="flex-basis: 496px;padding-top: 12px;">Correct Probing & taking brand (Company) name</div>
                     
                        </div>
                        <div class="col-md-4">
                            <div class="row" >
                           <div class="col-md-3">
                                <div class="std add" style="padding-top: 12px;">20</div>
                            </div>
                            <div class="col-md-9">
                                <div style="display: flex;column-gap: 32px;">
                                    <input type="number" name="9th" class="pin final" autocomplete="off" required onkeypress="return isNumber(event)"/>
                                
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0"
                                            aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                                            <span class="sr-only">60% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
    
                    </div>
    
    
    
    
                </div>
    
            </div>
    
            <div style=" margin-bottom: 20px;">
               <div class="row">
                <div class="col-md-10">
                    <div class="sb ">
                        overall Performance: <span style="color: #00C036;" class="per"></span>
                        <input type="hidden"  name="per">
                        <div style="float: right;">
                            <span style="margin-right:34px;" >Total</span>
                            <span style="margin-right:78px;" class="total"></span>
                            <input type="hidden"  name="tot">
                            <input type="hidden" class="ls" name="ls">
                            <span class="gotscore" style="margin-right:42px;"></span>
                            <input type="hidden"  name="got" value="">
                        </div>
                     
                    </div>
        
    
               </div>
                   <div class="col-md-2" style="display: grid;align-items:center;height:53px">
                    <button type="button" name="" class="ss" value="Submit">Submit</button>
                </form>
                   </div>
                </div>
    
            </div>
    
        </div>
        <!-- </div> -->
    
  </main>










    <script type="text/javascript">
        function isNumber(evt) {
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        return true;
    }
    
    </script>
    <script>
        function cnt(){
            let total_score = 0 
            $('.pin').each(function(){
                var inp_val = parseInt($(this).val())
                console.log("adf",$(this).val())
                if ($(this).val() != ""){
                    total_score += parseInt($(this).val())
                    $('.gotscore').html(total_score)
                    $('input[name=got]').val(total_score)
                    console.log("tts",total_score)
                }
            })
        }

        var total = 0
        var got=0
        ls=[]
        $(document).ready(function(){

	$('.header-title').html("Score")
            ls=[]
            $(".add").each(function(){
            ls.push(parseInt($(this).text()))
            total += parseFloat($(this).text()); 
          });
          console.log(ls)
          $(".ls").val(ls)
          console.log("its",$(".ls").val())
     
       $(".total").append(total)
       $("input[name=tot").val(total)
       
    $('input').on('keyup', function () {
        var value = parseFloat(this.value);
        var c=parseInt($(this).parent().parent().prev().children().html())
        
        if (parseFloat($(this).val()) > c) {
            $(this).val(c) 
        }

	


    var wrappingTd = $(this).parent().parent();
    calc=parseFloat(value/c)
    f=parseFloat(calc*100)
    $("input",wrappingTd).attr({"max":c})
    
    console.log("calc")

    $(' .progress-bar', wrappingTd)
    
        .css('width', f + '%')
        .attr('aria-valuenow', f);
        if (f <= 35){
                $(".progress-bar", wrappingTd).css({"background":"red "})
            }
            else if(f <=75){
                $(".progress-bar", wrappingTd).css({"background":"#F3C215 "})
            }
            else if(f <=100){
                $(".progress-bar", wrappingTd).css({"background":"#00C036 "})
            }
            else{
                $(".progress-bar", wrappingTd).css({"background":"none"})
            }
            
            cnt()
        
        
        });


//   $("input").keydown(function () {
//     // Save old value.
//     if (!$(this).val() || (parseInt($(this).val()) <= 20 && parseInt($(this).val()) >= 0))
//     $(this).data("old", $(this).val());
//   });
//   $("input").keyup(function () {
//     // Check correct, else revert back to old value.
//     if (!$(this).val() || (parseInt($(this).val()) <= 20 && parseInt($(this).val()) >= 0))
//       ;
//     else
//       $(this).val($(this).data("old"));
//   });

        // $("input").focusout(function(){
        //     $(this).each(()=>{
        //         console.log($(this).val())
            // })
})
    
$(".final").focusout(function(){
  let got=$(".gotscore").text()
    if(got <= 35){
        console.log(got)
        $(".per").html("")
        $(".per").append("AVERAGE")
        $("input[name=per").val("AVERAGE")
    }
    else if(got <=75){
        console.log(got)
        $(".per").html("")
        $(".per").append("GOOD")
        $("input[name=per").val("GOOD")
            }
            else if(got <=100){
                console.log(got)
                $(".per").html("")
                $(".per").append("EXCELLENT")
                $("input[name=per").val("EXCELLENT")
              }
              else{
                console.log(got)
                $(".per").html("")
                $("input[name=got").val("")
              }
   })

          

  $(document).on("click", '.playnow',function() {
     
     var isPlaying = $(this).parent().children('audio').get(0)
     
     // console.log(isPlaying.paused , isPlaying.currentTime > 0 , !isPlaying.ended)
     if (isPlaying.paused == false ){
       isPlaying.pause()
       $(this).attr('src','/static/Images/pause.png')
     }else{
       isPlaying.play();
       $(this).attr('src','/static/Images/play.png')

     }
     // var audio = $("#track1")[0];
     // audio.play();
   });

   $(".ss").click(function(){
        var fdata=new FormData()
        fdata.append("id",$("input[name=data_id]").val())
        fdata.append("1st",$("input[name=1st]").val())
        fdata.append("2nd",$("input[name=2nd]").val())
        fdata.append("3rd",$("input[name=3rd]").val())
        fdata.append("4th",$("input[name=4th]").val())
        fdata.append("5th",$("input[name=5th]").val())
        fdata.append("6th",$("input[name=6th]").val())
        fdata.append("7th",$("input[name=7th]").val())
        fdata.append("8th",$("input[name=8th]").val())
        fdata.append("9th",$("input[name=9th]").val())
        fdata.append("tot",$("input[name=tot]").val())
        fdata.append("got",$("input[name=got]").val())
        fdata.append("per",$("input[name=per]").val())
        fdata.append("ls",$("input[name=ls]").val())


        $.ajax({
        method: 'post',
        headers: {
        "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        url: "{% url 'score' %}",
        datatype:'json',
        data:fdata,
        processData: false,
        contentType: false,
        success: function (e) {
            if (e.status == 200){
                window.location.href=`/quality`
            }
            }
         })
   })
        
    </script>
  {% endblock content %}